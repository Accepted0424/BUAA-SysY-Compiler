# 编译器总体设计与实现目标

## 一、设计目标与实现范围

本项目旨在实现一个面向教学与实验验证的编译器原型系统，其核心目标是在保持体系结构清晰与可扩展性的前提下，完整覆盖从源程序到目标代码生成的主要编译阶段。

### 1. 目标语言

编译器面向 **SysY 语言子集**，支持的语言特性包括：

* 基本数据类型：整型（`int`）
* 复合数据结构：一维与多维数组
* 程序结构：函数定义与函数调用
* 控制流结构：条件分支与循环语句
* 内建函数与 I/O：`getint`、`printf`

该语言子集在语义与结构上具有代表性，能够覆盖典型编译技术（词法分析、语法分析、语义分析、代码生成与优化）的核心问题。

### 2. 输出目标

编译器支持多层次输出形式，以满足调试、验证与性能评估的不同需求：

* **中间结果输出**：
  LLVM 风格的中间表示（IR）文本，用于观察程序结构与中间优化效果；
* **最终目标代码**：
  面向 MIPS 架构的汇编代码，可直接用于模拟器或实验环境运行。

---

## 二、总体编译流程

编译器整体采用经典的多阶段流水线结构，各阶段职责清晰、接口明确：

1. **词法分析（Lexer）**
   将输入的字符流解析为结构化的 Token 流，识别关键字、标识符、字面量及运算符等基本词法单元。

2. **语法分析（Parser）**
   基于 Token 流构建抽象语法树（AST），准确反映源程序的语法结构与层次关系。

3. **语义分析（Semantic Analysis）**
   在 AST 的基础上结合符号表（Symbol Table）进行：

    * 类型与作用域检查
    * 重复定义与未定义引用检测
    * 常量表达式求值与语义约束验证
      该阶段确保程序在语义层面是正确且一致的。

4. **中间代码生成（IRGen）**
   将语义正确的 AST 转换为自定义的 LLVM 风格 IR，构建 IR Module、Function 与 BasicBlock 等核心结构，为后续优化与代码生成提供统一中间表示。

5. **中间代码优化（Optimize）**
   在 IR 层面执行轻量级、目标无关的优化，包括但不限于：

    * 常量折叠（Constant Folding）
    * 死代码消除（Dead Code Elimination）
    * 控制流图（CFG）化简
      该阶段在不显著增加实现复杂度的前提下提升生成代码的质量。

6. **目标代码生成（CodeGen）**
   将优化后的 IR 映射为 MIPS 汇编指令序列，完成寄存器使用、指令选择与输出格式化；同时保留输出 LLVM 风格 IR 文本的能力，便于调试与分析。

---

## 三、模块划分与工程结构

从工程实现角度出发，项目采用模块化的源码组织方式，以保证系统结构清晰、职责边界明确：

* **`src/main.cpp`**
  编译流程驱动模块，负责各阶段的调度、参数解析以及不同形式输出结果的统一管理。

* **`src/frontend/`**
  前端实现模块，包含：

    * 词法分析（Lexer）
    * 语法分析（Parser）
    * 抽象语法树（AST）
    * 符号表（SymbolTable）
    * 错误处理与诊断（Error）

* **`src/llvm/`**
  中间表示与后端相关模块，涵盖：

    * 自定义 LLVM 风格 IR 的数据结构定义
    * Pass 与优化框架
    * IR 文本输出
    * MIPS 汇编生成（Asm / Mips Printer）

* **`test/`**
  测试与验证模块，存放回归测试用例，用于验证各阶段功能的正确性与稳定性。

---

## 四、关键接口与设计原则

在接口设计与实现策略上，本项目遵循以下原则：

* **与参考编译器接口风格保持一致**
  Lexer、Parser 以及基于 Visitor 模式的 AST 遍历接口在设计上尽量对齐 LLVM / Clang 等主流编译器的抽象方式，从而：

    * 降低理解与迁移成本；
    * 便于复用现有测试脚本；
    * 保持输出格式与行为的一致性，提升可验证性。

* **阶段间通过清晰的数据结构解耦**
  各编译阶段通过 AST、SymbolTable 与 IR 等中间结构进行通信，避免阶段间的强耦合，便于后续扩展与重构。

---